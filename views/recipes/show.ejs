<%- include("../partials/header") %>
<div class="img-wrapper">
    <img src="<%= recipe.imageURL%>"style="max-height: 700px; max-width: 700px;">
</div><hr>


<h3 class="freddy">Description:</h3>
<p><%= recipe.description%></p>
<hr><br>

<h3 class="freddy">Ingredients:</h3>
<ul>
    <% recipe.ingredients.forEach(ing => { %>
        <li><%= ing%></li>
    <% }) %>
</ul>
<hr><br>

<h3 class="freddy">Instructions:</h3>
<ol>
    <% recipe.instructions.forEach(inst => { %>
        <li><%= inst%></li>
    <% }) %>
</ol>
<hr><br>

<a href="/recipes/<%= recipe._id%>/edit">Update Recipe</a>
<hr><br>

<h3>Comments:</h3>
<form action="/recipes/<%= recipe._id%>/comments" method="POST">
    <label>
        <textarea name="text" cols="50" rows="5"></textarea>
    </label><br>
    <input type="submit" value="Add Comment">
</form>
<hr><br>

<% if (recipe.comments.length) {%>
    <% recipe.comments.forEach(comment => { %>
        <img src="<%= comment.avatar%>" height="50" width="50">
        <h4><%= comment.author%> says:</h6>
        
        <% if(comment.user.equals(user && user._id)) { %>
            <!-- something to note; because we added this if block AFTER we've pretty much set up the entire 
            app, we were running into a problem where we couldn't render a page because some of the comments
            for that recipe were created early on and did not have .user key; we fixed this issue by manually
            deleting those comments in mongodbAtlas  -->
        <form action="/recipes/<%= recipe._id%>/comments/<%= comment._id%>?_method=DELETE" method="POST">       
            <input type="submit" value="X">
        </form>
        <% } %>

            <!-- NOTE! remember that html can only GET and POST requests; so we'll be needing method-override again
            to convert this "POST" request to a "DELETE" request (this is done by: "?_method=DELETE" appended to the
            end of our comment id); -->
        <p><%= comment.text%></p>
        <hr>

    <% }) %>
<% }%>

<%- include("../partials/footer") %>